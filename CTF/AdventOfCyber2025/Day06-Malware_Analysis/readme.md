## Walkthrough of Day06 - Malware Analysis - Egg-xecutable


## Theory - What will we learn?
1. The principles of malware analysis
2. An introduction to sandboxes
3. Static vs. dynamic analysis
4. Tools of the trade: PeStudio, ProcMon, Regsho


* Static analysis focuses on inspecting a file without executing it
* dynamic analysis involves execution. 
* Sandbox --> Virtual Enviroment used to test malware and malicous code safely

### Static Analysis
What info we want to gather in the static analysis?
1. Checksums 
2. Strings
3. Imports --> List of libraries and function the application uses.
4. Resources 

### Practical Static Analysis
* use `PeStudio`
* Load the malware/exe Into PeStudio
1. Indicators -> md5 & SHA256 hash's
2. Strings -> This could be, for example, IP addresses, URLs, commands, or even passwords!

### Dynamic Analysis
1. `Regshot` - Analyize registry change before and after malware execution
* A common technique for malware is to add a Run key into the registry, which is frequently used to specify which applications are automatically executed when the device is powered on.
2. `ProcMon` -> "Process Monitor" ,Show how various process interact with windows OS, and what yher are doing 
* Intresting process's
    * RegOpenKey
    * CreateFile
    * TCP Connect
    * TCP Recieve

#### Filtering
* Top left corner -> Filter -> Filter(Ctrl+L)
1. Process Name IS `MALWARE_NAME` -> ADD -> Ok
2. Operation Contains TCP --> add






##
## Answers
#### Q: Static analysis: What is the SHA256Sum of the HopHelper.exe?

 
#### A: `F29C270068F865EF4A747E2683BFA07667BF64E768B38FBB9A2750A3D879CA33`
* Inside pestudio -> load hophelper.exe -> Check sha256 hash value
##
#### Q:  Within the strings of HopHelper.exe, a flag with the format THM{XXXXX} exists. What is that flag value?
#### A: `THM{STRINGS_FOUND}`
* Inside pestudio -> load hophelper.exe -> Strings
* Sort by value, Scroll intil T and find the flag
##
#### Q:  Dynamic analysis: What registry value has the HopHelper.exe modified for persistence?


#### A: `HKU\S-1-5-21-1966530601-3185510712-10604624-1008\Software\Microsoft\Windows\CurrentVersion\Run\HopHelper: "C:\Users\DFIRUser\Desktop\HopHelper\HopHelper.exe"`
#### Steps:
* Open rehsgot
* Capture reg before running  HopHelper.exe
* Run HopHelper.exe
* Capture reg after running exe
* Compare both Captures
* Inside the log search for HopHelper.exe

##
#### Q: Dynamic analysis: Filter the output of ProcMon for "TCP" operations. What network protocol is HopHelper.exe using to communicate?

#### A: `HTTP`
#### Steps:
* Open procmon
* Filter for:
    * Process Name IS `HopHelper.exe` -> ADD -> Ok
    * Operation Contains `TCP` -> ADD -> Ok
* Expand the info and look at the dest port
* Check the protocol

##
#### Bonus: Can you find the web panel that HopHelper.exe is communicating with?
* You see the web site the malware is sending the data to is `http://breachblocker-sandbox/`
* Lets go to this website


## You completed the room!!!